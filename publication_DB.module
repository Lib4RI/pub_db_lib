<?php

/**
 * Implements hook_menu().
 */
function publication_DB_menu() {
    $items = array();
    $items['islandora/pubdb/get_mods'] = array(
        'page callback' => 'publication_DB_get_mods',
        'access arguments' => array('search islandora solr'),
        'type' => MENU_CALLBACK,
        //         'access arguments' => array(ISLANDORA_ADD_DS, 2),
    );
    
    $items['islandora/pubdb/scopus_alert'] = array(
        'page callback' => 'publication_DB_scopus_alert',
        'access arguments' => array('search islandora solr'),
        'type' => MENU_CALLBACK,
        //         'access arguments' => array(ISLANDORA_ADD_DS, 2),
    );
    
    $items['admin/islandora/publication_DB'] = array(
        'title' => 'Publication Alert',
        'description' => '',
        'page callback' => 'drupal_get_form',
        'page arguments' => array('publication_DB_admin_form'),
        'access arguments' => array('administer site configuration'),
        'file' => 'includes/forms.inc',
    );
    
    return $items;
}


function publication_DB_get_mods($query = NULL, $params = NULL){
    module_load_include('inc', 'publication_DB', 'utils/classes');
    
    $fetcher = new ScopusAbstractFetcher();
    $fetcher->setKey(variable_get('lib4ri_citco_api_key_scopus',''));
    $fetcher->setDoi($_GET['doi']);
    $fetcher->getDom()->formatOutput = true;
    $fetcher->fetch();
    
    drupal_add_http_header('Content-Type', 'application/xml');
    echo ($fetcher->getXML());
    
    
}

function publication_DB_scopus_alert($query = NULL, $params = NULL){

    module_load_include('inc', 'publication_DB', 'utils/classes');
//    module_load_include('inc', 'publication_DB', 'utils/functions');
//    module_load_include('module', 'lib4ri_json_search', 'lib4ri_json_search');

//    drupal_add_http_header('Content-Type', 'text/plain');
    $alert = new lib4riScopusAlert(variable_get('publication_DB_search_year', ''));
    $list = $alert->setNewPubs()->getNewPubs();
    var_dump($list);
}


    